<!DOCTYPE HTML>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0 minimal-ui" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/splash/splash-icon.png">
    <link rel="apple-touch-icon-precomposed" sizes="180x180" href="images/splash/splash-icon-big.png">
    <link rel="apple-touch-startup-image" href="images/splash/splash-screen.png"
        media="screen and (max-device-width: 320px)" />
    <link rel="apple-touch-startup-image" href="images/splash/splash-screen@2x.png"
        media="(max-device-width: 480px) and (-webkit-min-device-pixel-ratio: 2)" />
    <link rel="apple-touch-startup-image" href="images/splash/splash-screen-six.png" media="(device-width: 375px)">
    <link rel="apple-touch-startup-image" href="images/splash/splash-screen-six-plus.png" media="(device-width: 414px)">
    <link rel="apple-touch-startup-image" sizes="640x1096" href="images/splash/splash-screen@3x.png" />
    <link rel="apple-touch-startup-image" sizes="1024x748" href="images/splash/splash-screen-ipad-landscape"
        media="screen and (min-device-width : 481px) and (max-device-width : 1024px) and (orientation : landscape)" />
    <link rel="apple-touch-startup-image" sizes="768x1004" href="images/splash/splash-screen-ipad-portrait.png"
        media="screen and (min-device-width : 481px) and (max-device-width : 1024px) and (orientation : portrait)" />
    <link rel="apple-touch-startup-image" sizes="1536x2008" href="images/splash/splash-screen-ipad-portrait-retina.png"
        media="(device-width: 768px)	and (orientation: portrait)	and (-webkit-device-pixel-ratio: 2)" />
    <link rel="apple-touch-startup-image" sizes="1496x2048" href="images/splash/splash-screen-ipad-landscape-retina.png"
        media="(device-width: 768px)	and (orientation: landscape)	and (-webkit-device-pixel-ratio: 2)" />

    <title>Validação de Bilhetes</title>


    <link href="styles/style.css" rel="stylesheet" type="text/css">
    <link href="styles/framework.css" rel="stylesheet" type="text/css">
    <link href="styles/owl.theme.css" rel="stylesheet" type="text/css">
    <link href="styles/swipebox.css" rel="stylesheet" type="text/css">
    <link href="styles/font-awesome.css" rel="stylesheet" type="text/css">
    <link href="styles/animate.css" rel="stylesheet" type="text/css">

    <script type="text/javascript" src="scripts/jquery.js"></script>
    <script type="text/javascript" src="scripts/jqueryui.js"></script>
    <script type="text/javascript" src="scripts/framework.plugins.js"></script>
    <script type="text/javascript" src="scripts/custom.js"></script>

</head>

<body>
    <div id="preloader">
        <div id="status">
            <p class="center-text">
                A carregar a página...
                <em>O carregamento depende da velocidade da sua conexão à internet! Aguarde uns instantes!</em>
            </p>
        </div>
    </div>

    <div class="header">
        <h4 class="header-logo" style="color: #fff; width: 230px; font-size: 17px;" id="companhia">Barquense</h4>
        <a href="#" class="header-navigation"><i class="fa fa-power-off"
                style="font-size: large; line-height: 66px;"></i></a>
    </div>
    <div class="header-clear-big"></div>

    <div class="content" id="video">
        <div class="container no-bottom">
            <h3>Validação de Bilhetes</h3>
            <div class="decoration"></div>
            <div class="one-half-responsive" style="height: auto; width: auto;">
                <video muted playsinline id="qr-video" width="auto" height="auto"></video>
            </div>
        </div>
    </div>
    <div id="resultado" style="display: none;">
    </div>
    <script type="module">
        import QrScanner from "./scripts/qr-scanner.min.js";
        QrScanner.WORKER_PATH = './scripts/qr-scanner-worker.min.js';
    
        const video = document.getElementById('qr-video');
        
        function setResult(label, result) {
            label.textContent = result;
            camQrResultTimestamp.textContent = new Date().toString();
            label.style.color = 'teal';
            clearTimeout(label.highlightTimeout);
            label.highlightTimeout = setTimeout(() => label.style.color = 'inherit', 100);
        }

        QrScanner.hasCamera().then(hasCamera =>{ 
            if (hasCamera) {
                alert("Camera");
                const scanner = new QrScanner(video, result => {
                /*if (result.qrCodeID) {
                    let data = {
                        qrCodeId: result.qrCodeID,
                        company: "Barquense"
                    }
                    return fetch(`${urlBase}/`, {  //url
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: "include",
                    method: 'PUT', //pode ter que alterar
                    body: JSON.stringify(data)
                    }).then(response => {
                        if(response.status == 200) {*/
                            scanner.pause();
                            alert(result);
                            document.getElementById("video").hidden = true;
                            document.getElementById("resultado").style.cssText = "position: fixed; z-index: 99999; background-color: rgba(27, 169, 102, 0.6); width: 100%; height: 100%; top: 60px; left: 0px; display: block;";
                            setTimeout(() => {
                                document.getElementById("video").hidden = false;
                                document.getElementById("resultado").style.display = "none";
                                scanner.start();
                            }, 3000)
                        /*}
                    })
                }*/                
            });
            scanner.start();
        } else {
            alert("No camera");
        }
    });
        
        
    </script>
</body>